<!DOCTYPE html>
<!-- TODO Exercise 4: Add the Thymeleaf Security namespace -->
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head th:replace="fragments/fragments :: head"></head>
<body>
<div th:replace="fragments/fragments :: header"></div>
<div class="container">
    <div th:replace="fragments/fragments :: div#page-header"></div>
    <div class="row">
        <div class="col-lg-12">
            <h4>Employee List</h4>

            <div class="has-error" th:if="${error != null}">
                <span class="help-block" th:text="${error}"/>
            </div>
            <table class="table table-striped table-hover" id="employeeTable">
                <thead>
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>FunctionalLevel</th>
                    <th>Current Car</th>
                    <th>Car History</th>
                    <th class="text-right">Remove from service</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="rdEmployee : ${employeeList}">
                        <td th:text="${rdEmployee.firstName}"></td>
                        <td th:text="${rdEmployee.lastName}"></td>
                        <td>
                            <a class="btn btn-info btn-xs" th:href="${#mvc.url('REMC#decrementFunctionalLevel').arg(0, rdEmployee.id).build()}">-</a>
                            <span th:text="${rdEmployee.functionalLevel}"></span>
                            <a class="btn btn-info btn-xs" th:href="${#mvc.url('REMC#incrementFunctionalLevel').arg(0, rdEmployee.id).build()}">+</a>
                        </td>
                        <td>
                            <div th:if="${rdEmployee.currentOrder != null}">
                                <a th:href="${#mvc.url('ECMC#viewEmployeeCar').arg(0, rdEmployee.id).build()}" title="View more information about the employee's car">
                                    <span th:text="${rdEmployee.currentOrder.orderedCar.licensePlate}"></span>
                                </a>
                            </div>
                            <div th:if="${rdEmployee.currentOrder == null}">
                                No car assigned
                            </div>
                        </td>
                        <td><a class="btn btn-info btn-xs" th:href="${#mvc.url('ECMC#viewEmployeeCarHistory').arg(0, rdEmployee.id).build()}">View history details</a></td>
                        <td class="text-right"><a class="btn btn-danger btn-xs" th:href="${#mvc.url('REMC#removeFromService').arg(0, rdEmployee.id).build()}">Remove from service</a></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <hr/>
</div>
<div th:replace="fragments/fragments :: div.scripts"></div>
<script th:inline="javascript">
    $(document).ready(function () {
        $('#employeeTable').DataTable({
            dom: 'Bfrtip',
            buttons: [
                'copy', 'excel', 'pdf'
            ]
        });
    });
</script>
<!--<script th:inline="javascript">-->
    <!--/*<![CDATA[*/-->
    <!--var apiUrl = /*[[@{/fleet/employees/}]]*/ '/fleet/employees/';-->

    <!--$(document).ready(function () {-->
        <!--var dataTable = $('#employeeTable').DataTable();-->

        <!--$('.incr-btn').click(function(e) {-->
            <!--onIncrementBtnClick.apply(this, [e]);-->
        <!--});-->

        <!--function onIncrementBtnClick(e){-->
            <!--var $btn = $(this);-->
            <!--var id = $btn.attr('data-id');-->
            <!--$.get(apiUrl + id + '/incrementFunc', onSuccessful);-->
            <!--function onSuccessful() {-->
                <!--var $row = $btn.closest('tr');-->
                <!--var $funcLevelSpan = $row.find('.functional-level');-->
                <!--$funcLevelSpan.text(parseInt($funcLevelSpan.text(), 10) + 1);-->
            <!--}-->
        <!--}-->
    <!--});-->
    <!--/*]]>*/-->
<!--</script>-->
</body>
</html>